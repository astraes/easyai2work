"use strict";const e=require("../common/vendor.js"),n=require("./useCommon.js"),o=require("../types/index.js");exports.usePayHandlePayment=async r=>{const a=n.getLoginInfo();if(!a)throw new Error("未登录不允许支付");const t=await n.creatOrder({user_id:a._id,product_id:r._id,amount:{total:r.amount,currency:"CNY"},payer:{openid:n.getLoginInfo().wx_openid_mp},order_channel:o.IPayChannel.MP_WEIXIN}),{nonceStr:i,package:c,signType:s,paySign:d,timeStamp:p}=await n.getPrePay(t._id);console.log("paySign",d),console.log("created order",t),e.index.requestPayment({provider:"wxpay",orderInfo:t.product_id.name,timeStamp:p,nonceStr:i,package:c,signType:s,paySign:d,success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})};
