"use strict";const e=require("../../common/vendor.js"),o=require("../../composables/useCommon.js"),n=require("../../stores/appStore.js"),s=require("../../composables/useWorkFlow.js"),t=require("../../utils/emitter.js"),i=require("../../types/event.types.js");if(!Array){(e.resolveComponent("up-status-bar")+e.resolveComponent("up-avatar")+e.resolveComponent("up-icon")+e.resolveComponent("up-cell")+e.resolveComponent("up-cell-group"))()}Math||(r+(()=>"../../node-modules/uview-plus/components/u-status-bar/u-status-bar.js")+(()=>"../../node-modules/uview-plus/components/u-avatar/u-avatar.js")+l+a+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../node-modules/uview-plus/components/u-cell/u-cell.js")+(()=>"../../node-modules/uview-plus/components/u-cell-group/u-cell-group.js")+c+u)();const r=()=>"../../components/common/MyNavbar.js",u=()=>"../../layouts/BaseLayout.js",a=()=>"../../components/GetUserInfoPopup.js",c=()=>"../../node-modules/@tuniao/tnui-vue3-uniapp/components/icon/src/icon.js",l=()=>"../../components/home/UserMemberInfo.js",p=e.defineComponent({__name:"setting",setup(r){const{user:u}=e.storeToRefs(n.useAppStore());function a(){e.index.navigateTo({url:"/pages/history/history"})}e.ref(!0),e.ref("");const c=async()=>{if(o.isLogin.value)return;e.index.showLoading({title:"正在登录...",mask:!0});const{uniPlatform:n}=e.index.getSystemInfoSync();if("web"!==n)l();else{console.log("dev");const n=await o.loginByUsername({username:"test456",password:"123456"});o.saveLoginInfo(n),e.index.hideLoading()}},l=()=>{e.index.login({success:async function({code:n}){const s=await o.loginByWechatCode(n);o.saveLoginInfo(s),e.index.hideLoading()},fail:function(o){e.index.showToast({title:"登录错误",icon:"none"})}})},{socketInit:p}=s.useWorkFlow();e.onReady((()=>{p(),t.on(i.EventType.PAY_SUCCESS,(({order_id:e})=>m(e)))}));const m=async n=>{console.log("收到支付成功消息",n);const s=await o.getOrderInfoById(n);s[0]&&1===s[0].order_status&&(e.index.showToast({title:"支付成功",icon:"none"}),o.refreshUserInfo())},d=()=>{e.index.showLoading({title:"正在退出登录...",mask:!0}),o.loginOut(),e.index.hideLoading(),e.index.showToast({title:"退出成功",icon:"none"})},{showPay:g}=e.storeToRefs(n.useAppStore());return(n,s)=>e.e({a:e.o(c),b:e.p({src:e.unref(u).avatar_url,size:"80"}),c:!e.unref(o.isLogin)},(e.unref(o.isLogin),{}),{d:e.unref(o.isLogin)},e.unref(o.isLogin)?{e:e.t(e.unref(u).nickname)}:{},{f:e.unref(o.isLogin)},e.unref(o.isLogin)?{g:e.t(e.unref(u).balance)}:{},{h:e.p({name:"scan",color:"#969799",size:"28"}),i:e.p({name:"arrow-right",color:"#969799",size:"28"}),j:e.o((e=>g.value=!0)),k:e.p({icon:"rmb-circle",title:"成为会员"}),l:e.o(a),m:e.p({icon:"photo",title:"绘图历史"}),n:e.p({name:"logout"}),o:e.o(d),p:e.p({icon:"setting",title:"退出登录"})})}});wx.createPage(p);
