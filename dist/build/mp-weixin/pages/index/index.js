"use strict";const e=require("../../common/vendor.js"),o=require("../../composables/useCommon.js"),n=require("../../composables/useWorkFlow.js"),s=require("../../utils/request.js"),t=require("../../utils/common.js"),i=require("../../stores/appStore.js"),a=require("../../types/event.types.js"),r=require("../../utils/emitter.js");if(!Array){(e.resolveComponent("fui-tabs")+e.resolveComponent("fui-nav-bar")+e.resolveComponent("up-gap")+e.resolveComponent("up-status-bar")+e.resolveComponent("fui-footer")+e.resolveComponent("up-avatar")+e.resolveComponent("up-icon")+e.resolveComponent("up-cell")+e.resolveComponent("up-cell-group")+e.resolveComponent("template"))()}Math||((()=>"../../components/firstui/fui-tabs/fui-tabs.js")+(()=>"../../components/firstui/fui-nav-bar/fui-nav-bar.js")+f+d+(()=>"../../node-modules/uview-plus/components/u-gap/u-gap.js")+v+g+(()=>"../../node-modules/uview-plus/components/u-status-bar/u-status-bar.js")+m+u+(()=>"../../components/firstui/fui-footer/fui-footer.js")+(()=>"../../node-modules/uview-plus/components/u-avatar/u-avatar.js")+p+c+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../node-modules/uview-plus/components/u-cell/u-cell.js")+(()=>"../../node-modules/uview-plus/components/u-cell-group/u-cell-group.js")+l)();const u=()=>"../../layouts/BaseLayout.js",c=()=>"../../components/GetUserInfoPopup.js",l=()=>"../../node-modules/@tuniao/tnui-vue3-uniapp/components/icon/src/icon.js",p=()=>"../../components/home/UserMemberInfo.js",m=()=>"../../components/custom/MyGraphicCard/MyGraphicCard.js",d=()=>"../../components/home/AppSwiper.js",v=()=>"../../components/home/AppTags.js",g=()=>"../../components/home/AppWaterFall.js",f=()=>"../../components/firstui/fui-background-image/fui-background-image.js",h=e.defineComponent({__name:"index",setup(u){function c(){p.value=2,L.value=!0}e.ref("fuiNavBar");const{tabbarIndex:l}=e.storeToRefs(i.useAppStore()),p=e.ref(0),m=e=>{p.value=e.index,console.log("index",p.value)},d=e.ref("我的");const v=[{name:"首页",to:"/pages/index/index",onClick:l},{name:"创意",to:"/pages/creative/creative",onClick:l},{name:d,onClick:l}];e.onMounted((()=>{g()})),e.onUnmounted((()=>{f.value=[]}));const g=async()=>{f.value=await s.request("draw/history/findMany",{method:"POST",data:{history:{is_deleted:!1,is_public:!0}}})},f=e.ref([]),h=e.computed((()=>f.value.map((e=>{var o,n,s,i,a,r,u;return{id:e._id,avatar:(null==(o=e.user_id)?void 0:o.avatar_url)||"",username:(null==(n=e.user_id)?void 0:n.nickname)||(null==(s=e.user_id)?void 0:s.username),title:null==(i=e.options)?void 0:i.workflow_title,description:t.formatDateTime(new Date(e.created_at)),tags:e.tags,content:(null==(r=null==(a=e.params)?void 0:a.positive)?void 0:r.slice(0,120))+"...",images:(()=>{const o=[];for(const n in e.params)n.startsWith("image_path_")&&e.params[n]&&o.push(e.params[n]);return e.output?[...o,...e.output]:o})(),commentCount:null==(u=e.comment)?void 0:u.length}}))));function w(){e.index.navigateTo({url:"/pages/Empty/Empty"})}const{user:y}=e.storeToRefs(i.useAppStore());function j(){e.index.navigateTo({url:"/pages/history/history_fui/history_fui"})}e.ref(!0),e.ref("");const b=async()=>{if(o.isLogin.value)return;e.index.showLoading({title:"正在登录...",mask:!0});const{uniPlatform:n}=e.index.getSystemInfoSync();if("web"!==n)C();else{console.log("dev");const n=await o.loginByUsername({username:"test456",password:"123456"});o.saveLoginInfo(n),e.index.hideLoading()}d.value="我的"},C=()=>{e.index.login({success:async function({code:n}){const s=await o.loginByWechatCode(n);o.saveLoginInfo(s),e.index.hideLoading()},fail:function(o){e.index.showToast({title:"登录错误",icon:"none"})}})},{socketInit:_}=n.useWorkFlow();e.onReady((()=>{_(),r.on(a.EventType.PAY_SUCCESS,(({order_id:e})=>x(e))),o.isLogin.value?d.value="我的":d.value="登录"}));const x=async n=>{console.log("收到支付成功消息",n);const s=await o.getOrderInfoById(n);s[0]&&1===s[0].order_status&&(e.index.showToast({title:"支付成功",icon:"none"}),o.refreshUserInfo())},k=()=>{e.index.showLoading({title:"正在退出登录...",mask:!0}),o.loginOut(),e.index.hideLoading(),e.index.showToast({title:"退出成功",icon:"none"}),d.value="登录"},{showPay:L}=e.storeToRefs(i.useAppStore());return(n,s)=>e.e({a:e.o(m),b:e.p({direction:"column",color:"#ACB0D0",isSlider:!1,selectedColor:"#17135F",tabs:v,scale:"1.5",center:!1,short:!0,scroll:!1,itemPadding:"25",current:p.value,size:"28",fontWeight:"900",background:!0}),c:e.p({custom:!0,background:!0}),d:e.p({src:"@/src/static/Home2 (1).jpgHome2(1).jpg"}),e:e.p({height:"10"}),f:e.o(c),g:e.o(j),h:e.p({height:"10"}),i:0==p.value,j:e.p({src:"@/src/static/Home2 (1).jpgHome2(1).jpg"}),k:e.f(h.value,((o,n,s)=>({a:"449e0911-11-"+s+",449e0911-9",b:e.p({avatar:o.avatar,title:o.title,username:o.username,description:o.description,tags:o.tags,content:o.content,images:o.images,"view-count":o.viewCount,"comment-count":o.commentCount,"like-count":o.likeCount,"view-user-avatars":o.viewUserAvatars})}))),l:e.p({text:"Copyright © 2021 Fuzi-AI"}),m:1==p.value,n:e.p({src:"@/src/static/Home2 (1).jpgHome2(1).jpg"}),o:e.p({src:e.unref(y).avatar_url,size:"80"}),p:!e.unref(o.isLogin)},(e.unref(o.isLogin),{}),{q:e.unref(o.isLogin)},e.unref(o.isLogin)?{r:e.t(e.unref(y).nickname)}:{},{s:e.unref(o.isLogin)},e.unref(o.isLogin)?{t:e.t(e.unref(y).balance)}:{},{v:e.p({name:"scan",color:"#969799",size:"28"}),w:e.o(w),x:e.p({name:"arrow-right",color:"#969799",size:"28"}),y:e.o(w),z:e.o(b),A:e.o((e=>L.value=!0)),B:e.p({icon:"rmb-circle",title:"算力充值",border:!1}),C:e.o(j),D:e.p({border:!1,icon:"photo",title:"绘图历史"}),E:e.p({name:"logout"}),F:e.o(k),G:e.p({border:!1,icon:"setting",title:"退出登录"}),H:e.p({icon:"chat-fill",title:"微信客服"}),I:2==p.value})}}),w=e._export_sfc(h,[["__scopeId","data-v-449e0911"]]);wx.createPage(w);
