"use strict";const e=require("../../common/vendor.js"),o=require("../../types/index.js"),s=require("../../composables/useCommon.js"),t=require("../../composables/usePayment.js"),n=require("../../composables/useWorkFlow.js"),a=require("../../stores/appStore.js"),u=require("../../utils/emitter.js"),i=require("../../types/event.types.js"),c=require("../../utils/common.js");if(!Array){e.resolveComponent("up-button")()}Math||(l+r+(()=>"../../node-modules/uview-plus/components/u-button/u-button.js")+p)();const p=()=>"../../node-modules/@tuniao/tnui-vue3-uniapp/components/popup/src/popup.js",r=()=>"../../node-modules/@tuniao/tnui-vue3-uniapp/components/scroll-list/src/scroll-list.js",l=()=>"../../node-modules/@tuniao/tnui-vue3-uniapp/components/icon/src/icon.js",m=e.defineComponent({__name:"PaymentPopup",props:{title:{default:"请选择充值套餐"}},emits:["showPay"],setup(p){const{showPay:r}=e.storeToRefs(a.useAppStore()),l=e.computed({set:e=>{r.value=e,e||(d.value=0)},get:()=>{const{osName:o}=e.index.getSystemInfoSync();return!r.value||"ios"!==o&&"macos"!==o||(e.index.showToast({title:"IOS暂不支持在线支付",icon:"none"}),r.value=!1),r.value}});e.watch(l,(()=>{l.value&&v()}));const m=e.ref([]),d=e.ref(0);e.watch(d,(()=>{console.log(d.value)}));const{socketInit:v}=n.useWorkFlow();e.onReady((()=>{(async()=>{const e=await s.getProductList();e&&(m.value=e)})(),v({params:{type:o.IWebsocketSceneType.payStatusPush},onMessage:e=>{console.log("handle pay success message");const o=c.parseJSONToObject(e),{type:s}=o;"pay_success"===s&&(r.value=!1,u.emit(i.EventType.PAY_SUCCESS,{order_id:o.order_id}))}})}));const y=async()=>{if(!s.isLogin.value)return e.index.switchTab({url:"/pages/setting/setting"}),void e.index.showToast({title:"请先登录",icon:"none"});await v({params:{type:o.IWebsocketSceneType.payStatusPush}}),t.usePayHandlePayment(m.value[d.value])};return(o,s)=>({a:e.t(o.title),b:e.f(m.value,((o,s,t)=>e.e({a:e.t(o.name),b:e.t(o.amount/100),c:e.t(o.desc),d:s===d.value},s===d.value?{e:"7e29108b-2-"+t+",7e29108b-1",f:e.p({name:"check"})}:{},{g:e.o((e=>d.value=s),o._id),h:d.value===s?1:"",i:o._id,j:d.value===s?1:"",k:e.o((e=>d.value=s),o._id)}))),c:e.o(y),d:e.p({type:"primary",shape:"circle"}),e:e.o((e=>l.value=e)),f:e.p({"close-btn":!0,height:"66%","open-direction":"bottom",modelValue:l.value})})}}),d=e._export_sfc(m,[["__scopeId","data-v-7e29108b"]]);wx.createComponent(d);
